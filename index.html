<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Rubricator 3000</title>

		<link rel="stylesheet" href="https://cdn.simplecss.org/simple.min.css" />
		<link
			rel="stylesheet"
			type="text/css"
			href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css"
		/>
		<link rel="stylesheet" href="./index.css" />

		<script
			defer
			src="https://cdn.jsdelivr.net/npm/@alpinejs/persist@3.x.x/dist/cdn.min.js"
		></script>
		<script
			type="text/javascript"
			src="https://cdn.jsdelivr.net/npm/toastify-js"
		></script>
		<script defer src="//unpkg.com/alpinejs"></script>
		<script src="https://unpkg.com/feather-icons"></script>

		<script src="hardcoded_rubrics.js"></script>
	</head>
	<body>
		<main
			x-data="{
            revisadoPor: $persist(''),
            rubrics: 
            // $persist(
                {
                'example-0': platformerRubric,
                'example-1': shooterRubric,
                'example-2': arcadeRubric
            }
            // )
            ,
            selectedRubric: $persist('example-0'),
            editing: false,
            createNewRubric: function() {
                let newName = 'rubric-0';
                let i = 0;
                const nameSet = new Set(Object.values(this.rubrics).map(rubric => rubric.name));
                while (newName in nameSet) {
                    newName = `rubric-${i}`;
                } 

                const newId = `custom-${Date.now()}`;
                const newRubric = {
                    'id': newId,
                    'name': newName,
                    'rubric': exampleRubric
                }

                this.rubrics[newId] = newRubric;
                this.selectedRubric = newRubric.id;
            },
            deleteRubric: function() {
                delete this.rubrics[this.selectedRubric];
                this.selectedRubric = Object.keys(this.rubrics)[0];
            },
            switchedRubric: function() {
               this.editing = false 
            }
        }"
		>
			<label for="revisadoPor" class="bottom-gap"
				>Revisado por:
				<input
					id="revisadoPor"
					type="text"
					x-model="revisadoPor"
					placeholder="Nombre"
			/></label>

			<div class="flex-space column-when-small gap-half">
				<div class="flex-center gap-half">
					<b>Rúbrica:</b>
					<select x-model="selectedRubric" @change="switchedRubric">
						<template x-for="[id, rubric] of Object.entries(rubrics)">
							<option
								x-bind:value="id"
								x-text="rubric.name"
								:selected="selectedRubric===id"
							></option>
						</template>
					</select>

					<button @click="createNewRubric()" title="Nueva rúbrica">
						<i data-feather="plus-circle"></i>
					</button>
					<button
						@click="deleteRubric()"
						class="danger"
						title="Eliminar rúbrica"
					>
						<i data-feather="trash-2"></i>
					</button>
					<button
						@click="editing=true"
						class="info"
						x-show="!editing"
						x-transition
						title="Editar"
					>
						<i data-feather="edit"></i>
					</button>
				</div>

				<div class="flex-center gap-half">
					<button
						@click="editing=false"
						class="info"
						x-cloak
						x-show="editing"
						x-transition
						x-transition:leave.duration.0ms
						title="Finalizar edición"
					>
						<i data-feather="x"></i>
					</button>
					<input
						id="nombreRubrica"
						type="text"
						x-model="rubrics[selectedRubric].name"
						placeholder="Nombre"
						x-cloak
						x-show="editing"
						x-transition
						x-transition:leave.duration.0ms
					/>
				</div>
			</div>

			<!-- Grade with selected rubric -->

            
            <section>
                <div>
                    todo: Puntos, Bonus, Nota
                </div>

                <ul>
                    <template x-for="(subcategories, category) in rubrics[selectedRubric]['rubric']">
                        <li>
                            <u x-text="category"></u>
                            <ul>
                                <template x-for="(items, subcategory) in subcategories">
                                    <li>
                                        <span x-text="subcategory"></span>

                                        <ul>
                                            <template x-for="item in items">
                                                <li>
                                                    <code x-text="formatTypeAndValue(item.type, item.value)" :class="typeToClass(item.type)"></code>
                                                    <span x-text="item.name"></span>
                                                </li>
                                            </template>
                                        </ul>
                                    </li>
                                </template>
                            </ul>
                        </li>
                    </template>
                </ul>
            </section>

			<!-- Copy grading results -->
            <section>
                Resultado
            </section>
		</main>
		<footer>Página por: <a href="github.com/Nyveon">Eric K.</a></footer>

		<script>
			feather.replace();
		</script>
	</body>
</html>
