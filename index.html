<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Rubricator 3000</title>

		<link rel="stylesheet" href="https://cdn.simplecss.org/simple.min.css" />
		<link
			rel="stylesheet"
			type="text/css"
			href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css"
		/>
		<link rel="stylesheet" href="./index.css" />

		<script
			defer
			src="https://cdn.jsdelivr.net/npm/@alpinejs/persist@3.x.x/dist/cdn.min.js"
		></script>
		<script
			type="text/javascript"
			src="https://cdn.jsdelivr.net/npm/toastify-js"
		></script>
		<script defer src="//unpkg.com/alpinejs"></script>

        <script src="hardcoded_rubrics.js"></script>
	</head>
	<body>
        <main x-data="{
            revisadoPor: $persist(''),
            customRubrics: $persist([{'id': 'test', 'name': 'test', 'rubric': {}}]), //todo: persist
            hardcodedRubrics: [platformerRubric, shooterRubric, arcadeRubric],
            getAvailableRubrics: function() {
                return {
                    ...Object.fromEntries(this.customRubrics.map(rubric => [rubric.id, rubric])),
                    ...Object.fromEntries(this.hardcodedRubrics.map(rubric => [rubric.id, rubric]))
                };
            },
            selectedRubric: $persist('0'),
            createNewRubric: function() {
                let newName = 'rubric-0';
                let i = 0;
                while (newName in this.customRubrics) {
                    newName = `rubric-${i}`;
                } 

                const newRubric = {
                    'id': `custom-${Date.now()}`,
                    'name': newName,
                    'rubric': {}
                }

                this.customRubrics.push(newRubric);
                this.selectedRubric = newRubric.id;
            }
        }">
            <select x-model="selectedRubric">
                <template x-for="[id, rubric] of Object.entries(getAvailableRubrics())">
                    <option x-bind:value="id" x-text="rubric.name" :selected="selectedRubric===id"></option>
                </template>
            </select>

            <!-- Create new rubric -->
            <button @click="createNewRubric()">Crear nueva rúbrica</button>

            <div x-text="JSON.stringify(getAvailableRubrics())"></div>

            <!-- Grade with selected rubric -->
            <!-- Copy grading results -->
        </main>
        <footer>
            Página por: <a href="github.com/Nyveon">Eric K.</a>
        </footer>
    </body>
</html>
